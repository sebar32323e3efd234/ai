#!/bin/bash

# Katalog lokalny, gdzie znajdują się pliki do pakowania
LOCAL_DIR="/sciezka/do/katalogu"

# Katalog na zdalnym serwerze, gdzie będą przesyłane pliki
REMOTE_DIR="/sciezka/do/katalogu/na/serwerze"

# Adres serwera
SERVER="nazwa_serwera"

# Nazwa użytkownika SFTP
SFTP_USER="nazwa_uzytkownika"

# Hasło użytkownika SFTP (lepiej przekazać przez zmienną środowiskową lub bezpieczniejsze metody)
SFTP_PASSWORD="haslo"

# Pobranie daty dzisiejszej w formacie YYYY-MM-DD
TODAY=$(date +"%Y-%m-%d")

# Pętla po plikach w katalogu lokalnym
for FILE in $LOCAL_DIR/*; do
    # Sprawdzenie, czy plik jest plikiem i czy jego data modyfikacji jest dzisiaj
    if [ -f "$FILE" ] && [ "$(date -r "$FILE" +"%Y-%m-%d")" == "$TODAY" ]; then
        # Nazwa pliku bez ścieżki
        FILENAME=$(basename "$FILE")
        
        # Pakowanie pliku
        tar -czf "$LOCAL_DIR/$FILENAME.tar.gz" "$FILE"
        
        # Wysyłka spakowanego pliku przez SFTP
        echo "put $LOCAL_DIR/$FILENAME.tar.gz $REMOTE_DIR/$FILENAME.tar.gz" | sftp -oBatchMode=no -b-
        
        # Usuwanie spakowanego pliku lokalnego po wysłaniu
        rm "$LOCAL_DIR/$FILENAME.tar.gz"
        
        echo "Plik $FILENAME został pomyślnie wysłany i usunięty."
    fi
done
